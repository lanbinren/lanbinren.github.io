
---
title: 工作相关问题
---

**[Android-P 不能remount问题解决](#1)**
**[9.0 和 8.0 修改gpio状态](#2)**
**[指纹初始化失败](#3)**
**[Android源码 定位问题](#4)**

<div id="1"></div>
## Android-P 不能remount问题解决

* Android P + kernel-4.9 or after 
- download preloader with verified boot disabled which location is the same as scatter file. //preloader_<PROJECT>_SBOOT_DIS.bin
- boot to Home Screen
- go to setting -> system -> Developer options -> OEM unlocking
- adb reboot bootloader
- fastboot flashing unlock
- press volume up key
- fastboot reboot
- adb root
- adb disable-verity
- adb reboot
- adb root
- adb remount

* 请注意下载最新的adb/fastboot tool
Windows
https://dl.google.com/android/repository/platform-tools-latest-windows.zip
Mac
https://dl.google.com/android/repository/platform-tools-latest-darwin.zip
Linux
https://dl.google.com/android/repository/platform-tools-latest-linux.zip


<div id="2"></div>
## 9.0 和 8.0 修改gpio状态

echo mode 31 1 >  /sys/devices/platform/1000b000.pinctrl/mt_gpio 
{% asset_img 修改gpio状态.png 修改gpio状态 %}

adb shell echo -w=[pin]:[mode] [pullsel] [din] [dout] [pullen] [dir] [dinv] > /sys/devices/virtual/misc/mtgpio/pin
{% asset_img 修改gpio63之前.png gpio63修改之前的状态 %}

修改模式 # echo -wmode 63 6 > /sys/class/misc/mtgpio/pin
{% asset_img 修改gpio63之后.png gpio63修改之后的状态 %}


<div id="3"></div>
## 展讯SL8541E平台（与9832E相似）初始化偶尔·失败· 
失败时如下图
{% asset_img 指纹初始化失败.png 指纹初始化失败 %}
原因是 该ic等待中断时，判断错误，休眠时间不够。  改为休眠250ms。
{% asset_img 时序问题导致初始化失败.png spi时序 %}

关掉展讯log
echo 1 4 1 7 > /proc/sys/kernel/printk


<div id="4"></div>
## Android源码在线查看
http://androidxref.com 

### 指纹比对5次失败之后 修改等待时间
/frameworks/base/core/java/android/hardware/fingerprint/FingerprintManager.java
{% codeblock %}
private static final long FAIL_LOCKOUT_TIMEOUT_MS = 30*1000;
{% endcodeblock %}
{% asset_img 指纹5次比对失败.png 修改等待时间 %}



### 密码解锁后，仍在比对状态，追踪上层代码
怀疑有多次调用
/hardware/interfaces/biometrics/fingerprint/2.1/default/BiometricsFingerprint.cpp
{% asset_img getAuthenticatorId.png getAuthenticatorId.java %}
{% codeblock %}
   /**
     * Retrieves the authenticator token for binding keys to the lifecycle
     * of the calling user's fingerprints. Used only by internal clients.
     *
     * @hide
     */
    public long getAuthenticatorId() {
        if (mService != null) {
            try {
                return mService.getAuthenticatorId(mContext.getOpPackageName());
            } catch (RemoteException e) {
                throw e.rethrowFromSystemServer();
            }
        } else {
            Slog.w(TAG, "getAuthenticatorId(): Service not connected!");
        }
        return 0;
    }
{% endcodeblock %}


